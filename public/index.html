<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Lamp Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-purple-50 via-white to-purple-100 min-h-screen flex items-center justify-center">

    <div class="w-full max-w-lg bg-white shadow-2xl rounded-2xl p-8">
        <h1 class="text-4xl font-extrabold text-purple-800 text-center mb-6">ðŸŽ‡ Lamp Ceremony Room Creator</h1>

        <div class="space-y-4">
            <input id="roomName" type="text" placeholder="Room Name"
                class="w-full border-2 border-purple-300 p-3 rounded-xl focus:ring-2 focus:ring-purple-500 focus:outline-none" />

            <input id="lampCount" type="number" placeholder="Number of Lamps"
                class="w-full border-2 border-purple-300 p-3 rounded-xl focus:ring-2 focus:ring-purple-500 focus:outline-none" />

            <button id="createBtn"
                class="w-full bg-purple-600 text-white font-semibold p-3 rounded-xl hover:bg-purple-700 transition-all shadow-lg">
                Create Room âœ¨
            </button>
        </div>

        <div id="output" class="hidden mt-6 p-4 bg-purple-50 border border-purple-200 rounded-xl space-y-3">
            <h2 class="text-xl font-semibold text-purple-700">Share These Links</h2>

            <div>
                <p class="font-medium text-purple-600">Participant (view-only):</p>
                <div id="participantLink"
                    class="bg-white p-2 rounded text-sm font-mono break-all border border-purple-200 mt-1"></div>
            </div>

            <div>
                <p class="font-medium text-purple-600">Chief Guest (control):</p>
                <div id="chiefGuestLink"
                    class="bg-white p-2 rounded text-sm font-mono break-all border border-purple-200 mt-1"></div>
            </div>
        </div>
    </div>

    <script>
        const createBtn = document.getElementById("createBtn");
        const roomNameInput = document.getElementById("roomName");
        const lampCountInput = document.getElementById("lampCount");
        const outputDiv = document.getElementById("output");
        const participantLinkDiv = document.getElementById("participantLink");
        const chiefGuestLinkDiv = document.getElementById("chiefGuestLink");

        createBtn.addEventListener("click", async () => {
            const name = roomNameInput.value.trim();
            const lampCount = parseInt(lampCountInput.value, 10);

            // Validation
            if (!name) return alert("Please enter a valid room name.");
            if (!lampCount || lampCount < 1) return alert("Please enter a valid number of lamps (at least 1).");

            // Send create request
            try {
                const res = await fetch("/api/create-room", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, lampCount }),
                });
                const data = await res.json();
                if (!res.ok) return alert(JSON.stringify(data));

                // Show links
                outputDiv.classList.remove("hidden");
                const base = window.location.origin;
                participantLinkDiv.textContent = base + data.participantLink;
                chiefGuestLinkDiv.textContent = base + data.chiefGuestLink;
            } catch (err) {
                alert("Error creating room: " + err.message);
            }
        });
    </script>

</body>

</html>