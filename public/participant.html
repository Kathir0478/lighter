<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Participant - Lamp Ceremony</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body
    class="bg-gradient-to-r from-blue-50 via-white to-blue-100 min-h-screen flex flex-col items-center justify-center">

    <!-- Header -->
    <div class="text-center mb-10">
        <h1 class="text-3xl font-bold text-blue-800">ðŸŒŸ Welcome, Participant ðŸŒŸ</h1>
        <p class="text-lg text-gray-600 mt-2">Watch the ceremonial lamps being lit in real-time</p>
    </div>

    <!-- Lamp Circle -->
    <div id="lampContainer" class="relative w-[400px] h-[400px] flex items-center justify-center"></div>

    <!-- Status -->
    <div id="status" class="mt-6 text-center text-gray-700 text-lg italic">
        Waiting for the Chief Guest and others to light the lamps...
    </div>

    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get("roomId");

        const lampContainer = document.getElementById("lampContainer");
        const statusEl = document.getElementById("status");

        function renderLamps(lampCount, lampStates) {
            lampContainer.innerHTML = "";
            const radius = 150;
            const centerX = 200;
            const centerY = 200;

            for (let i = 0; i < lampCount; i++) {
                const angle = (i / lampCount) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const lamp = document.createElement("div");
                lamp.className = `absolute w-16 h-16 rounded-full shadow-md border-4 flex items-center justify-center transition 
          ${lampStates[i] ? "bg-yellow-400 border-yellow-600 animate-pulse" : "bg-gray-200 border-gray-400"}`;
                lamp.style.left = `${x - 32}px`;
                lamp.style.top = `${y - 32}px`;
                lamp.innerHTML = lampStates[i] ? "ðŸ”¥" : "ðŸª”";
                lampContainer.appendChild(lamp);
            }
        }

        socket.emit("join-room", { roomId });

        socket.on("room-data", ({ lamps, lampStates }) => {
            renderLamps(lamps, lampStates);
        });

        socket.on("lamp-updated", ({ lampStates }) => {
            renderLamps(lampStates.length, lampStates);
            statusEl.textContent = "âœ¨ The lamps are being lit! âœ¨";
        });
    </script>
</body>

</html>