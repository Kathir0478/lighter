<!doctype html>
<html>

<head>
    <title>Lamp Ceremony</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body class="bg-gray-50 p-6">
    <div class="max-w-xl mx-auto text-center">
        <h1 class="text-2xl font-bold mb-4">Lamp Lighting Ceremony</h1>
        <div id="lamps" class="flex justify-center gap-4 mb-6"></div>
        <button id="lightBtn" class="hidden bg-yellow-500 text-white rounded-lg px-4 py-2 hover:bg-yellow-600">
            Light Lamp
        </button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get("roomId");
        const role = urlParams.get("role");

        const socket = io();
        socket.emit("join-room", { roomId });

        const lampsDiv = document.getElementById("lamps");
        const btn = document.getElementById("lightBtn");

        socket.on("room-data", (room) => {
            lampsDiv.innerHTML = "";
            for (let i = 0; i < room.lamps; i++) {
                const lamp = document.createElement("div");
                lamp.className =
                    "w-12 h-12 rounded-full border bg-gray-300 flex items-center justify-center";
                lamp.textContent = "ðŸª”";
                lamp.id = "lamp-" + i;
                if (room.lampStates[i]) lamp.classList.replace("bg-gray-300", "bg-yellow-400");
                lampsDiv.appendChild(lamp);
            }
            if (role === "chief") btn.classList.remove("hidden");
        });

        socket.on("lamp-lit", ({ lampIndex }) => {
            const lamp = document.getElementById("lamp-" + lampIndex);
            if (lamp) lamp.classList.replace("bg-gray-300", "bg-yellow-400");
        });

        socket.on("error-message", ({ msg }) => {
            alert(msg);
            btn.disabled = true;
            btn.classList.add("opacity-50", "cursor-not-allowed");
        });

        btn.addEventListener("click", () => {
            socket.emit("light-lamp", { roomId });
            btn.disabled = true;
            btn.classList.add("opacity-50", "cursor-not-allowed");
        });
    </script>
</body>

</html>